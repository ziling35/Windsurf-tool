# 自动删除账号信息功能说明

## 功能概述

在切换账号并启动 Windsurf 后，软件会自动监控 Windsurf 是否成功识别账号。一旦 Windsurf 识别到账号信息，软件会自动删除本地存储的账号配置，确保用户下次登录时必须再次通过 PaperCrane 工具。

## 工作流程

1. **切换账号** - 用户通过软件切换到新账号
2. **写入账号信息** - 软件将账号信息写入 Windsurf 配置文件
3. **启动 Windsurf** - 软件自动启动 Windsurf
4. **监控账号识别** - 软件开始监控 Windsurf 是否识别账号
   - 每 2 秒检查一次数据库中的 session 数据
   - 最多检查 60 次（约 2 分钟）
5. **识别成功** - Windsurf 成功加载账号信息
6. **等待 3 秒** - 确保 Windsurf 完全加载账号
7. **删除本地信息** - 自动删除本地的账号配置
8. **完成** - 用户可以正常使用 Windsurf，但本地已无账号信息

## 技术实现

### 新增模块

- **`modules/accountRecognitionMonitor.js`** - 账号识别监控器
  - `checkAccountRecognized()` - 检查账号是否被识别
  - `deleteLocalAccountInfo()` - 删除本地账号信息
  - `startMonitoring()` - 启动监控
  - `stopMonitoring()` - 停止监控

### 修改文件

- **`main.js`**
  - 导入 `AccountRecognitionMonitor` 模块
  - 在 `switch-account` 处理函数中集成监控
  - 在 `switch-to-history-account` 处理函数中集成监控

## 监控参数

- **检查间隔**: 2000ms (2秒)
- **最大检查次数**: 60 次
- **总超时时间**: 约 2 分钟
- **识别后等待**: 3 秒

## 用户体验

切换账号时，用户会看到以下进度提示：

1. ✅ 已启动 Windsurf
2. 👁️ 正在监控账号识别状态...
3. 🔒 Windsurf 已识别账号，本地账号信息已删除

如果监控超时：
- ⚠️ 账号识别监控超时，请手动检查

## 测试步骤

### 1. 准备测试环境

确保已安装并配置好 Windsurf。

### 2. 切换账号

通过 PaperCrane 工具切换到一个账号。

### 3. 观察日志

在控制台中观察以下日志：

```
👁️ === 启动账号识别监控 ===
   检查间隔: 2000ms
   最大检查次数: 60

🔍 检查账号识别状态 (1/60)...
⚠️ 数据库文件不存在，等待创建...

🔍 检查账号识别状态 (2/60)...
✅ Windsurf 已识别账号
   明文 sessions 数量: 1

⏳ 等待 3 秒确保 Windsurf 完全加载账号...

🗑️ === 开始删除本地账号信息 ===
✅ 本地账号信息已删除
   用户下次登录必须通过 PaperCrane 工具

🛑 账号识别监控已停止
✅ 账号识别监控完成，本地账号信息已删除
```

### 4. 验证删除结果

关闭 Windsurf，再次打开，应该会提示需要登录。

### 5. 再次测试

再次通过 PaperCrane 工具切换账号，验证流程是否正常。

## 故障排查

### 监控超时

如果出现监控超时：
1. 检查 Windsurf 是否正常启动
2. 检查数据库文件路径是否正确
3. 检查 Windsurf 是否有权限写入配置文件

### 删除失败

如果删除本地账号信息失败：
1. 检查数据库文件是否被锁定
2. 检查文件权限
3. 查看详细错误日志

### Windsurf 未识别账号

如果 Windsurf 一直未识别账号：
1. 检查写入的账号信息是否正确
2. 检查 Windsurf 版本是否兼容
3. 手动检查数据库中的 session 数据

## 安全性说明

- 本功能确保用户每次使用 Windsurf 都必须通过 PaperCrane 工具登录
- 账号信息在 Windsurf 识别后立即删除，减少本地存储风险
- 监控过程不会干扰 Windsurf 的正常运行

## 注意事项

1. **不要手动关闭 Windsurf** - 在监控期间关闭 Windsurf 可能导致监控失败
2. **等待监控完成** - 切换账号后等待监控完成再进行其他操作
3. **网络连接** - 确保网络连接正常，Windsurf 需要联网验证账号
